# AssureX Platform Architecture

**Complete architectural overview of the AssureX multi-tenant SaaS platform**

**Last Updated**: October 31, 2025
**Version**: 1.0.0

---

## ğŸ“‹ Table of Contents

1. [System Overview](#system-overview)
2. [High-Level Architecture](#high-level-architecture)
3. [Repository Architecture](#repository-architecture)
4. [AWS Infrastructure](#aws-infrastructure)
5. [Data Flow & Pipeline Orchestration](#data-flow--pipeline-orchestration)
6. [Multi-Tenant Architecture](#multi-tenant-architecture)
7. [Security Architecture](#security-architecture)
8. [Network Architecture](#network-architecture)
9. [API Architecture](#api-architecture)
10. [AI/ML Architecture](#aiml-architecture)
11. [Deployment Architecture](#deployment-architecture)

---

## System Overview

AssureX is a multi-tenant SaaS compliance and security management platform that combines traditional reliability with AI-powered intelligence for real-time insights, automated workflows, and seamless security integrations.

### Core Components

| Component | Technology | Purpose |
|-----------|------------|---------|
| **Frontend** | Next.js 14, React, TailwindCSS | User interface and experience |
| **Integration API** | AWS AppSync, Lambda, GraphQL | Third-party integrations (GitHub, Jira, Okta, Entra) |
| **Profile360 API** | FastAPI, Lambda, API Gateway | User analytics and insights |
| **Insights Engine** | Python, Lambda, Bedrock | ETL processing and AI agents |
| **Database** | PostgreSQL RDS | Persistent data storage (multi-tenant schemas) |
| **Knowledge Graph** | Neo4j Aura | User-app-group relationship graphs |
| **Authentication** | Auth0 | JWT-based authentication and authorization |

### Technology Stack

```
Frontend:    Next.js 14, React, TypeScript, TailwindCSS
Backend:     Python 3.12, Node.js 18+, FastAPI
AWS:         Lambda, AppSync, API Gateway, RDS, Secrets Manager, Bedrock
Database:    PostgreSQL 17.4, Neo4j Aura
AI/ML:       AWS Bedrock (Claude Haiku, Claude Sonnet, Titan Embeddings)
IaC:         Serverless Framework, CloudFormation
Auth:        Auth0 (JWT tokens)
```

---

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AssureX Platform                               â”‚
â”‚                    Multi-Tenant SaaS Architecture                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚             â”‚
                    â–¼             â–¼             â–¼

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Frontend UI    â”‚  â”‚  Integration API â”‚  â”‚  Profile360 API  â”‚
        â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
        â”‚  Next.js App     â”‚  â”‚  AppSync         â”‚  â”‚  FastAPI         â”‚
        â”‚  Vercel          â”‚  â”‚  GraphQL         â”‚  â”‚  REST API        â”‚
        â”‚                  â”‚â—„â”€â”¤  Lambda          â”‚  â”‚  Lambda          â”‚
        â”‚  app.trustx      â”‚  â”‚                  â”‚  â”‚                  â”‚
        â”‚  .cloud          â”‚  â”‚  AWS AppSync     â”‚  â”‚  API Gateway     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                   â”‚
                    â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              Insights Engine (ETL & AI)                â”‚
        â”‚                                                         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚Event Router  â”‚  â”‚AI Agents     â”‚  â”‚ETL Processorsâ”‚ â”‚
        â”‚  â”‚(Orchestrator)â”‚â”€â”€â”‚(Bedrock)     â”‚  â”‚(Traditional) â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                         â”‚
        â”‚  Lambda Functions â€¢ S3 Storage â€¢ EventBridge Triggers   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                    â”‚                 â”‚      â”‚
                    â–¼                 â–¼      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   PostgreSQL     â”‚  â”‚   Neo4j Aura     â”‚  â”‚  AWS Bedrock     â”‚
        â”‚   RDS (Multi-    â”‚  â”‚   (Multi-Tenant) â”‚  â”‚  (AI/ML)         â”‚
        â”‚   Tenant)        â”‚  â”‚                  â”‚  â”‚                  â”‚
        â”‚                  â”‚  â”‚  Knowledge Graph â”‚  â”‚  Claude Haiku    â”‚
        â”‚  Schema per      â”‚  â”‚  Per Tenant      â”‚  â”‚  Claude Sonnet   â”‚
        â”‚  Tenant          â”‚  â”‚                  â”‚  â”‚  Titan Embeddingsâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       External Integrations         â”‚
                    â”‚  GitHub â€¢ Jira â€¢ Okta â€¢ Entra ID   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Repository Architecture

AssureX consists of 4 independent repositories working together:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Repository Architecture                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   trustx (Frontend) â”‚         â”‚  assurex-infra      â”‚
â”‚                     â”‚         â”‚  (Infrastructure)   â”‚
â”‚  â€¢ Next.js 14       â”‚         â”‚                     â”‚
â”‚  â€¢ React Components â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â€¢ Lambda Functions â”‚
â”‚  â€¢ Auth0 JWT        â”‚         â”‚  â€¢ AppSync GraphQL  â”‚
â”‚  â€¢ API Clients      â”‚         â”‚  â€¢ VPC/Networking   â”‚
â”‚  â€¢ TailwindCSS      â”‚         â”‚  â€¢ RDS PostgreSQL   â”‚
â”‚                     â”‚         â”‚  â€¢ Secrets Manager  â”‚
â”‚  Deployment:        â”‚         â”‚                     â”‚
â”‚  Vercel (main)      â”‚         â”‚  Deployment:        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  Serverless (dev)   â”‚
                                â”‚  Serverless (preprod)â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                      â”‚                      â”‚
                    â–¼                      â–¼                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ profile-360-backend â”‚  â”‚ assurex-insights-   â”‚  â”‚ External Resources  â”‚
        â”‚ (User Analytics)    â”‚  â”‚ engine (ETL & AI)   â”‚  â”‚                     â”‚
        â”‚                     â”‚  â”‚                     â”‚  â”‚ â€¢ Neo4j Aura        â”‚
        â”‚ â€¢ FastAPI           â”‚  â”‚ â€¢ Event Router      â”‚  â”‚ â€¢ AWS Bedrock       â”‚
        â”‚ â€¢ Neo4j Client      â”‚  â”‚ â€¢ ETL Processors    â”‚  â”‚ â€¢ Auth0             â”‚
        â”‚ â€¢ PostgreSQL        â”‚  â”‚ â€¢ AI Agents:        â”‚  â”‚ â€¢ GitHub API        â”‚
        â”‚ â€¢ Lambda Handler    â”‚  â”‚   - Dormant User    â”‚  â”‚ â€¢ Jira API          â”‚
        â”‚ â€¢ API Gateway       â”‚  â”‚   - Privilege Creep â”‚  â”‚ â€¢ Okta API          â”‚
        â”‚                     â”‚  â”‚ â€¢ Vectorization     â”‚  â”‚ â€¢ Entra ID API      â”‚
        â”‚ Deployment:         â”‚  â”‚ â€¢ Neo4j Sync        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Serverless (dev)    â”‚  â”‚                     â”‚
        â”‚ Serverless (preprod)â”‚  â”‚ Deployment:         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ Serverless (dev)    â”‚
                                 â”‚ Serverless (preprod)â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Repository Responsibilities

| Repository | Lines of Code | Primary Language | Deployment Target | Key Responsibility |
|------------|---------------|------------------|-------------------|-------------------|
| **trustx** | ~15,000 | TypeScript | Vercel | User interface, Auth0 integration |
| **assurex-infra** | ~8,000 | Python, JavaScript | AWS Lambda | Integration handlers, GraphQL API |
| **profile-360-backend** | ~5,000 | Python | AWS Lambda | User analytics, Neo4j, REST API |
| **assurex-insights-engine** | ~7,000 | Python | AWS Lambda | ETL, AI agents, data orchestration |

---

## AWS Infrastructure

### Infrastructure Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AWS Infrastructure Layout                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Region: us-east-1 (dev/prod) | us-east-2 (preprod)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPC (10.0.0.0/16 dev | 10.1.0.0/16 preprod)                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Public Subnets (2 AZs)                                     â”‚    â”‚
â”‚  â”‚  â€¢ 10.0.1.0/24 (us-east-1a)                                â”‚    â”‚
â”‚  â”‚  â€¢ 10.0.2.0/24 (us-east-1b)                                â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚    â”‚
â”‚  â”‚  â”‚ NAT Gateway   â”‚  â”‚ Internet      â”‚                     â”‚    â”‚
â”‚  â”‚  â”‚ (AZ-A)        â”‚  â”‚ Gateway       â”‚                     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Private Subnets (2 AZs)                                    â”‚    â”‚
â”‚  â”‚  â€¢ 10.0.11.0/24 (us-east-1a)                               â”‚    â”‚
â”‚  â”‚  â€¢ 10.0.12.0/24 (us-east-1b)                               â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  Lambda Functions (VPC-attached)                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Integration handlers                              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Profile360 API                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ ETL processors                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ AI agents                                         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Event router                                      â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  RDS PostgreSQL (Multi-AZ)                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Engine: PostgreSQL 17.4                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Instance: db.t3.micro                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Storage: 20GB gp3 (encrypted)                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Multi-tenant schemas                             â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Security Groups                                            â”‚    â”‚
â”‚  â”‚  â€¢ Lambda SG (outbound: 443, 5432, 7687, 53)              â”‚    â”‚
â”‚  â”‚  â€¢ RDS SG (inbound: 5432 from Lambda SG)                  â”‚    â”‚
â”‚  â”‚  â€¢ Bastion SG (inbound: 22 from specific IPs)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway & AppSync (Internet-facing)                            â”‚
â”‚  â€¢ API Gateway HTTP API (Profile360)                                â”‚
â”‚  â€¢ AppSync GraphQL API (Integrations)                               â”‚
â”‚  â€¢ Custom domains: api-dev.trustx.cloud, api-stg.trustx.cloud      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External Services (Outside VPC)                                    â”‚
â”‚  â€¢ Neo4j Aura (per tenant, internet-accessible)                     â”‚
â”‚  â€¢ AWS Bedrock (managed AI/ML service)                              â”‚
â”‚  â€¢ AWS Secrets Manager (credentials storage)                        â”‚
â”‚  â€¢ S3 (integration data, ETL staging)                               â”‚
â”‚  â€¢ CloudWatch Logs (monitoring)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AWS Services Used

| Service | Purpose | Configuration |
|---------|---------|---------------|
| **Lambda** | Serverless compute for all backend logic | Python 3.12, 512MB memory, 30s timeout |
| **API Gateway v2** | HTTP API for Profile360 | Custom domain, JWT authorizer |
| **AppSync** | GraphQL API for integrations | AWS Cognito & Lambda authorizers |
| **RDS PostgreSQL** | Primary database | 17.4, db.t3.micro, 20GB gp3, multi-tenant schemas |
| **VPC** | Network isolation | 2 AZs, public/private subnets, NAT Gateway |
| **Secrets Manager** | Credential storage | Per-tenant secrets, Neo4j configs |
| **S3** | Data storage | Integration data, ETL staging, logs |
| **Bedrock** | AI/ML models | Claude Haiku, Claude Sonnet, Titan Embeddings |
| **CloudWatch** | Logging & monitoring | Lambda logs, metrics, alarms |
| **EventBridge** | Event routing | Scheduled triggers, custom events |

---

## Data Flow & Pipeline Orchestration

### Complete Data Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    End-to-End Data Pipeline                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User Initiates Sync
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚  Clicks "Sync" button for GitHub integration
â”‚ (trustx) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ GraphQL mutation: syncIntegration
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AppSync GraphQL  â”‚  Validates JWT, routes to Lambda
â”‚ (assurex-infra)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Invokes integration handler
     â–¼

Step 2: Integration Handler
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Integration Lambda       â”‚  Calls GitHub API
â”‚ (assurex-infra)          â”‚  Fetches users, repos, teams
â”‚                          â”‚
â”‚ â€¢ github_handler.py      â”‚  Transforms data
â”‚ â€¢ API authentication     â”‚  Stores to S3
â”‚ â€¢ Data extraction        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Writes raw JSON to S3
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ S3 Bucket                â”‚  assurex-dev-tenant-{tenant_id}/
â”‚ (Integration Data)       â”‚  integrations/github/raw/
â”‚                          â”‚  YYYY-MM-DD-HH-MM-SS.json
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ S3 event notification (future)
     â”‚ OR manual trigger
     â–¼

Step 3: Event Router (Orchestrator)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Event Router Lambda                                   â”‚
â”‚           (assurex-insights-engine)                                  â”‚
â”‚                                                                      â”‚
â”‚  Input: { tenant_id, trigger_source: "sync_completed" }            â”‚
â”‚                                                                      â”‚
â”‚  Orchestrates 6 Lambda functions asynchronously (parallel):         â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ 1. ETL       â”‚  â”‚ 2. Vector-   â”‚  â”‚ 3. Neo4j     â”‚             â”‚
â”‚  â”‚              â”‚  â”‚    ization   â”‚  â”‚    Sync      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ 4. Analytics â”‚  â”‚ 5. Dormant   â”‚  â”‚ 6. Privilege â”‚             â”‚
â”‚  â”‚              â”‚  â”‚    User      â”‚  â”‚    Creep     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                      â”‚
â”‚  All invocations return 202 (async processing)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                  â”‚                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
            â–¼            â–¼      â–¼           â–¼    â–¼           â–¼

Step 4: Parallel Processing
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ETL Processor    â”‚  â”‚ Vectorization    â”‚  â”‚ Neo4j Sync       â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚ â€¢ Extract from   â”‚  â”‚ â€¢ Generate       â”‚  â”‚ â€¢ Sync users     â”‚
â”‚   S3             â”‚  â”‚   embeddings     â”‚  â”‚ â€¢ Sync groups    â”‚
â”‚ â€¢ Transform data â”‚  â”‚ â€¢ Store in       â”‚  â”‚ â€¢ Sync apps      â”‚
â”‚ â€¢ Load to DB     â”‚  â”‚   pgvector       â”‚  â”‚ â€¢ Create edges   â”‚
â”‚                  â”‚  â”‚ â€¢ Use Bedrock    â”‚  â”‚                  â”‚
â”‚ Result:          â”‚  â”‚   Titan          â”‚  â”‚ Result:          â”‚
â”‚ 91 users         â”‚  â”‚                  â”‚  â”‚ 45 users         â”‚
â”‚ 178 groups       â”‚  â”‚ Result:          â”‚  â”‚ 33 groups        â”‚
â”‚ 561 apps         â”‚  â”‚ 150 embeddings   â”‚  â”‚ 63 apps          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ 252 relationshipsâ”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analytics        â”‚  â”‚ Dormant User     â”‚  â”‚ Privilege Creep  â”‚
â”‚                  â”‚  â”‚ Agent (AI)       â”‚  â”‚ Agent (AI)       â”‚
â”‚ â€¢ Calculate      â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚   metrics        â”‚  â”‚ â€¢ Query inactive â”‚  â”‚ â€¢ Analyze perms  â”‚
â”‚ â€¢ User stats     â”‚  â”‚   users          â”‚  â”‚ â€¢ Use Bedrock    â”‚
â”‚ â€¢ App usage      â”‚  â”‚ â€¢ Use Bedrock    â”‚  â”‚   Claude         â”‚
â”‚ â€¢ Group analysis â”‚  â”‚   Claude         â”‚  â”‚ â€¢ Generate       â”‚
â”‚                  â”‚  â”‚ â€¢ Generate       â”‚  â”‚   insights       â”‚
â”‚ Result:          â”‚  â”‚   insights       â”‚  â”‚                  â”‚
â”‚ 25 insights      â”‚  â”‚                  â”‚  â”‚ Result:          â”‚
â”‚ 10 reports       â”‚  â”‚ Result:          â”‚  â”‚ 31 users         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ 12 dormant users â”‚  â”‚ 5 HIGH_RISK      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ 9 MODERATE       â”‚
                                            â”‚ 17 APPROPRIATE   â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 5: Storage & Retrieval
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Storage                                                     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ PostgreSQL RDS    â”‚  â”‚ Neo4j Aura        â”‚                   â”‚
â”‚  â”‚                   â”‚  â”‚                   â”‚                   â”‚
â”‚  â”‚ tenant_123456:    â”‚  â”‚ Graph per tenant: â”‚                   â”‚
â”‚  â”‚ â€¢ sso_users       â”‚  â”‚ â€¢ User nodes      â”‚                   â”‚
â”‚  â”‚ â€¢ groups          â”‚  â”‚ â€¢ Group nodes     â”‚                   â”‚
â”‚  â”‚ â€¢ apps            â”‚  â”‚ â€¢ App nodes       â”‚                   â”‚
â”‚  â”‚ â€¢ insights        â”‚  â”‚ â€¢ Relationships   â”‚                   â”‚
â”‚  â”‚ â€¢ embeddings      â”‚  â”‚                   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ API requests
                              â–¼
Step 6: API Access
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Profile360 API (FastAPI)                                        â”‚
â”‚                                                                   â”‚
â”‚  GET /api/privilege-creep/summary                                â”‚
â”‚  GET /api/dormant-users                                          â”‚
â”‚  GET /api/knowledge-graph/stats                                  â”‚
â”‚  GET /api/analytics/user-insights                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP responses
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (trustx)                                               â”‚
â”‚  Displays insights, privilege creep, dormant users to user       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event Router Orchestration Details

**Event Format:**
```json
{
  "tenant_id": 118230,
  "trigger_source": "sync_completed",
  "triggered_at": "2025-10-31T01:13:32.920304"
}
```

**Invocation Pattern:**
- All 6 Lambda functions invoked asynchronously (`InvocationType='Event'`)
- Each returns status code `202` (Accepted)
- Processing continues in background
- No blocking between components

**Error Handling:**
- Individual component failures don't block others
- Event router logs all invocations
- CloudWatch alarms for failures
- Dead-letter queues for failed events (future)

---

## Multi-Tenant Architecture

### Tenant Isolation Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Multi-Tenant Isolation                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database: PostgreSQL RDS                                          â”‚
â”‚  Pattern: Schema-based multi-tenancy                               â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  public schema (shared)                                     â”‚   â”‚
â”‚  â”‚  â€¢ tenants (registry)                                       â”‚   â”‚
â”‚  â”‚  â€¢ frameworks (SOC2, ISO 27001, NIST)                       â”‚   â”‚
â”‚  â”‚  â€¢ controls (TX-* codes)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  tenant_118230 (trustx - completely isolated)               â”‚   â”‚
â”‚  â”‚  â€¢ sso_users, groups, apps                                  â”‚   â”‚
â”‚  â”‚  â€¢ group_memberships, app_assignments                       â”‚   â”‚
â”‚  â”‚  â€¢ user_activities, user_profiles                           â”‚   â”‚
â”‚  â”‚  â€¢ privilege_creep_insights, dormant_user_insights          â”‚   â”‚
â”‚  â”‚  â€¢ embeddings, knowledge_graph_metadata                     â”‚   â”‚
â”‚  â”‚  â€¢ ... 100+ tables                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  tenant_758734 (trustxinc - completely isolated)            â”‚   â”‚
â”‚  â”‚  Same structure as tenant_118230                            â”‚   â”‚
â”‚  â”‚  100% data isolation, separate schema namespace             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Neo4j: Separate instance per tenant                                â”‚
â”‚                                                                      â”‚
â”‚  Tenant 118230:                    Tenant 758734:                   â”‚
â”‚  â€¢ URI: neo4j+s://abc.neo4j.io   â€¢ URI: neo4j+s://xyz.neo4j.io    â”‚
â”‚  â€¢ Database: neo4j                â€¢ Database: neo4j                 â”‚
â”‚  â€¢ Credentials in Secrets Manager â€¢ Credentials in Secrets Manager  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  S3: Separate bucket prefixes per tenant                            â”‚
â”‚                                                                      â”‚
â”‚  Bucket: assurex-dev-tenant-118230/                                 â”‚
â”‚  â€¢ integrations/github/raw/                                         â”‚
â”‚  â€¢ integrations/jira/raw/                                           â”‚
â”‚  â€¢ etl/staging/                                                     â”‚
â”‚  â€¢ etl/processed/                                                   â”‚
â”‚                                                                      â”‚
â”‚  Bucket: assurex-dev-tenant-758734/                                 â”‚
â”‚  Same structure, completely separate bucket                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Secrets Manager: Per-tenant secrets                                â”‚
â”‚                                                                      â”‚
â”‚  assurex/dev/tenant/118230/integrations                             â”‚
â”‚  {                                                                   â”‚
â”‚    "neo4j": { "uri": "...", "user": "...", "password": "..." },    â”‚
â”‚    "github": { "token": "..." },                                    â”‚
â”‚    "jira": { "token": "..." }                                       â”‚
â”‚  }                                                                   â”‚
â”‚                                                                      â”‚
â”‚  assurex/dev/tenant/758734/integrations                             â”‚
â”‚  Separate credentials, separate secret                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tenant Resolution Flow

```
1. User Login
   â†“
   Auth0 generates JWT with custom claims:
   - https://trustx.cloud/claims/company = "trustx"
   - https://trustx.cloud/claims/user_id = "auth0|123..."
   - https://trustx.cloud/claims/role = "admin"
   â†“
2. API Request
   Frontend sends JWT in Authorization header
   â†“
3. API Gateway / AppSync Authorizer
   Validates JWT signature and expiration
   â†“
4. Lambda Handler
   Extracts company claim from JWT
   Queries: SELECT id FROM public.tenants WHERE tenant_name = 'trustx'
   Gets: tenant_id = 118230
   â†“
5. Database Queries
   All queries use: SET search_path TO tenant_118230
   Complete data isolation enforced
   â†“
6. Neo4j Queries
   Fetches tenant-specific Neo4j config from Secrets Manager
   Connects to tenant's dedicated Neo4j instance
   â†“
7. Response
   Returns only data for tenant 118230
   Zero visibility into other tenants
```

### Benefits of This Pattern

âœ… **Complete Data Isolation**: Each tenant's data in separate schema/instance
âœ… **Scalability**: Easy to move tenants to dedicated databases if needed
âœ… **Performance**: No cross-tenant queries, efficient indexes per schema
âœ… **Security**: Schema-level access control, credential isolation
âœ… **Compliance**: Tenant data can be deleted/exported independently
âœ… **Debugging**: Easy to inspect single tenant's data

---

## Security Architecture

### Authentication & Authorization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Authentication & Authorization                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. User Login
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  User    â”‚  Navigates to app.trustx.cloud
   â”‚ (Browser)â”‚  Clicks "Login"
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Redirect to Auth0
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Auth0           â”‚  Universal Login page
   â”‚  trustx.us.      â”‚  Email/password or SSO
   â”‚  auth0.com       â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Successful authentication
        â”‚ Generate JWT with custom claims
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  JWT Token                                                â”‚
   â”‚  {                                                        â”‚
   â”‚    "iss": "https://trustx.us.auth0.com/",                â”‚
   â”‚    "sub": "auth0|679b1a896743...",                       â”‚
   â”‚    "aud": ["https://api-dev.trustx.cloud"],             â”‚
   â”‚    "exp": 1759595768,                                    â”‚
   â”‚    "https://trustx.cloud/claims/company": "trustx",      â”‚
   â”‚    "https://trustx.cloud/claims/user_id": "auth0|...",   â”‚
   â”‚    "https://trustx.cloud/claims/role": "admin"           â”‚
   â”‚  }                                                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ Stored in browser (httpOnly cookie or localStorage)
                      â–¼

2. API Request
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Frontendâ”‚  Sends API request
   â”‚  (trustx)â”‚  Authorization: Bearer <JWT>
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ HTTP request with JWT
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  API Gateway     â”‚  HTTP API with JWT authorizer
   â”‚  (Profile360)    â”‚  OR
   â”‚                  â”‚  AppSync with Lambda authorizer
   â”‚  OR              â”‚
   â”‚                  â”‚  1. Validates JWT signature (RS256)
   â”‚  AppSync         â”‚  2. Checks expiration
   â”‚  (Integrations)  â”‚  3. Verifies audience
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ JWT valid, passes to Lambda
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Lambda Handler  â”‚  1. Extract claims from JWT
   â”‚                  â”‚  2. Get tenant_id from company claim
   â”‚  â€¢ Tenant        â”‚  3. Set database context
   â”‚    resolution    â”‚  4. Enforce row-level security
   â”‚  â€¢ Authorization â”‚  5. Execute business logic
   â”‚    checks        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Layers

| Layer | Mechanism | Purpose |
|-------|-----------|---------|
| **Network** | VPC, Security Groups, NACLs | Isolate Lambda/RDS in private subnets |
| **Transport** | TLS 1.2+ | Encrypt all data in transit |
| **Authentication** | Auth0 JWT (RS256) | Verify user identity |
| **Authorization** | JWT claims, role-based access | Control what users can access |
| **Data** | Tenant schema isolation | Prevent cross-tenant data access |
| **Secrets** | AWS Secrets Manager | Secure credential storage |
| **Storage** | RDS encryption at rest (AES-256) | Protect data at rest |
| **API** | Rate limiting, WAF (future) | Prevent abuse |

### IAM Roles & Policies

**Lambda Execution Role:**
- AWSLambdaVPCAccessExecutionRole (managed policy)
- SecretsManager:GetSecretValue (tenant-specific secrets)
- RDS:DescribeDBInstances (read-only)
- S3:GetObject, S3:PutObject (tenant-specific buckets)
- Bedrock:InvokeModel (AI/ML inference)
- CloudWatch:PutLogEvents (logging)

**Principle of Least Privilege:**
- Each Lambda has minimal required permissions
- Tenant-specific secrets scoped by tenant_id
- No wildcard permissions in production

---

## Network Architecture

### VPC Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPC: assurex-dev (10.0.0.0/16) - us-east-1                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Availability Zone: us-east-1a                                      â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Public Subnet A (10.0.1.0/24)                             â”‚    â”‚
â”‚  â”‚  â€¢ NAT Gateway                                             â”‚    â”‚
â”‚  â”‚  â€¢ Bastion Host (t3.nano)                                  â”‚    â”‚
â”‚  â”‚  â€¢ Elastic IP attached                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Private Subnet A (10.0.11.0/24)                           â”‚    â”‚
â”‚  â”‚  â€¢ Lambda ENIs                                             â”‚    â”‚
â”‚  â”‚  â€¢ RDS Primary Instance                                    â”‚    â”‚
â”‚  â”‚  â€¢ No direct internet access                               â”‚    â”‚
â”‚  â”‚  â€¢ Routes through NAT Gateway for outbound                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Availability Zone: us-east-1b                                      â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Public Subnet B (10.0.2.0/24)                             â”‚    â”‚
â”‚  â”‚  â€¢ Internet Gateway (shared)                               â”‚    â”‚
â”‚  â”‚  â€¢ Future: Second NAT Gateway for HA                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Private Subnet B (10.0.12.0/24)                           â”‚    â”‚
â”‚  â”‚  â€¢ Lambda ENIs                                             â”‚    â”‚
â”‚  â”‚  â€¢ RDS Standby Instance (Multi-AZ)                         â”‚    â”‚
â”‚  â”‚  â€¢ Automatic failover support                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Groups                                                    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Lambda-SG (attached to all Lambda functions)              â”‚    â”‚
â”‚  â”‚  Inbound: None                                             â”‚    â”‚
â”‚  â”‚  Outbound:                                                 â”‚    â”‚
â”‚  â”‚    â€¢ TCP 443 â†’ 0.0.0.0/0 (HTTPS - API calls, Bedrock)     â”‚    â”‚
â”‚  â”‚    â€¢ TCP 5432 â†’ RDS-SG (PostgreSQL)                        â”‚    â”‚
â”‚  â”‚    â€¢ TCP 7687 â†’ 0.0.0.0/0 (Neo4j Bolt protocol)           â”‚    â”‚
â”‚  â”‚    â€¢ UDP 53 â†’ 0.0.0.0/0 (DNS)                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  RDS-SG (attached to RDS PostgreSQL)                       â”‚    â”‚
â”‚  â”‚  Inbound:                                                  â”‚    â”‚
â”‚  â”‚    â€¢ TCP 5432 from Lambda-SG                               â”‚    â”‚
â”‚  â”‚    â€¢ TCP 5432 from Bastion-SG                              â”‚    â”‚
â”‚  â”‚  Outbound: None required                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Bastion-SG (attached to bastion host)                     â”‚    â”‚
â”‚  â”‚  Inbound:                                                  â”‚    â”‚
â”‚  â”‚    â€¢ TCP 22 from specific IP (dev workstation)             â”‚    â”‚
â”‚  â”‚  Outbound:                                                 â”‚    â”‚
â”‚  â”‚    â€¢ TCP 5432 â†’ RDS-SG (database access)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Route Tables                                                       â”‚
â”‚                                                                      â”‚
â”‚  Public Subnets:                                                    â”‚
â”‚  â€¢ 0.0.0.0/0 â†’ Internet Gateway (igw-xxx)                          â”‚
â”‚  â€¢ 10.0.0.0/16 â†’ local                                             â”‚
â”‚                                                                      â”‚
â”‚  Private Subnets:                                                   â”‚
â”‚  â€¢ 0.0.0.0/0 â†’ NAT Gateway (nat-xxx)                               â”‚
â”‚  â€¢ 10.0.0.0/16 â†’ local                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Network Flow Examples

**Lambda â†’ RDS:**
```
Lambda (10.0.11.x) â†’ RDS-SG â†’ RDS (10.0.11.y:5432)
âœ… Allowed by Lambda-SG outbound + RDS-SG inbound
```

**Lambda â†’ Neo4j Aura:**
```
Lambda (10.0.11.x) â†’ NAT Gateway â†’ Internet Gateway â†’ Neo4j (internet)
âœ… Allowed by Lambda-SG outbound 443
```

**Lambda â†’ AWS Bedrock:**
```
Lambda (10.0.11.x) â†’ NAT Gateway â†’ Internet Gateway â†’ Bedrock API
âœ… Allowed by Lambda-SG outbound 443
```

**Developer â†’ RDS (via Bastion):**
```
Developer (internet) â†’ Bastion (10.0.1.x:22) â†’ RDS (10.0.11.y:5432)
âœ… SSH tunnel through bastion, then psql connection
```

---

## API Architecture

### API Gateway & AppSync

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API Architecture                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Integration API (GraphQL - AppSync)                             â”‚
â”‚  Domain: https://api-dev.trustx.cloud/graphql                    â”‚
â”‚                                                                   â”‚
â”‚  Mutations:                                                       â”‚
â”‚  â€¢ configureGitHub(input: ConfigureGitHubInput!)                 â”‚
â”‚  â€¢ configureJira(input: ConfigureJiraInput!)                     â”‚
â”‚  â€¢ configureOkta(input: ConfigureOktaInput!)                     â”‚
â”‚  â€¢ configureEntraID(input: ConfigureEntraIDInput!)               â”‚
â”‚  â€¢ syncIntegration(integrationId: ID!)                           â”‚
â”‚                                                                   â”‚
â”‚  Queries:                                                         â”‚
â”‚  â€¢ listIntegrations                                               â”‚
â”‚  â€¢ getIntegration(id: ID!)                                        â”‚
â”‚  â€¢ getSyncStatus(integrationId: ID!)                              â”‚
â”‚                                                                   â”‚
â”‚  Authorization: Lambda authorizer (JWT validation)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Profile360 API (REST - API Gateway HTTP API)                   â”‚
â”‚  Domain: https://api-dev.trustx.cloud/profile360                â”‚
â”‚                                                                   â”‚
â”‚  User Management:                                                 â”‚
â”‚  GET    /api/users                                                â”‚
â”‚  GET    /api/users/{user_id}                                      â”‚
â”‚  PUT    /api/users/{user_id}                                      â”‚
â”‚  POST   /api/users/{user_id}/activities                           â”‚
â”‚                                                                   â”‚
â”‚  Dormant User Detection:                                          â”‚
â”‚  GET    /api/dormant-users?days=90                                â”‚
â”‚  GET    /api/users/{email}/stale-apps?days=60                     â”‚
â”‚                                                                   â”‚
â”‚  Privilege Creep Detection:                                       â”‚
â”‚  GET    /api/privilege-creep/summary                              â”‚
â”‚  GET    /api/privilege-creep/users?risk_level=HIGH                â”‚
â”‚  GET    /api/privilege-creep/users/{user_id}                      â”‚
â”‚  GET    /api/privilege-creep/risk-distribution                    â”‚
â”‚  GET    /api/privilege-creep/insights?category=excessive_apps     â”‚
â”‚                                                                   â”‚
â”‚  Knowledge Graph (Neo4j):                                         â”‚
â”‚  GET    /api/knowledge-graph/health                               â”‚
â”‚  POST   /api/knowledge-graph/query                                â”‚
â”‚  GET    /api/knowledge-graph/stats                                â”‚
â”‚                                                                   â”‚
â”‚  Analytics:                                                        â”‚
â”‚  GET    /api/analytics/user-insights                              â”‚
â”‚  GET    /api/analytics/health                                     â”‚
â”‚                                                                   â”‚
â”‚  Authorization: JWT authorizer (Auth0)                            â”‚
â”‚  Authentication: Bearer token in Authorization header             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Request Flow

```
Client Request
     â”‚
     â”‚ HTTPS (TLS 1.2+)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CloudFront      â”‚  Optional CDN layer (future)
â”‚  (future)        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway     â”‚  â€¢ Rate limiting
â”‚  or AppSync      â”‚  â€¢ JWT validation
â”‚                  â”‚  â€¢ Request transformation
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Invoke Lambda
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lambda Handler  â”‚  â€¢ VPC-attached
â”‚                  â”‚  â€¢ Tenant resolution
â”‚                  â”‚  â€¢ Business logic
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚             â”‚             â”‚
     â–¼              â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQLâ”‚ â”‚ Neo4j Auraâ”‚  â”‚Bedrock â”‚  â”‚ S3 Bucket  â”‚
â”‚   RDS    â”‚  â”‚  (Graph)  â”‚  â”‚ (AI)   â”‚  â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚             â”‚             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              Response JSON
                    â”‚
                    â–¼
                 Client
```

---

## AI/ML Architecture

### AWS Bedrock Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI/ML Architecture (AWS Bedrock)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Use Case 1: Privilege Creep Detection                          â”‚
â”‚                                                                   â”‚
â”‚  Input:                                                           â”‚
â”‚  â€¢ User profile (name, email, department)                         â”‚
â”‚  â€¢ Number of groups user is member of                             â”‚
â”‚  â€¢ Number of applications user has access to                      â”‚
â”‚  â€¢ Peer users in same department (for comparison)                 â”‚
â”‚                                                                   â”‚
â”‚  Model: Claude 3 Haiku (anthropic.claude-3-haiku-20240307-v1:0) â”‚
â”‚                                                                   â”‚
â”‚  Prompt:                                                          â”‚
â”‚  "Analyze this user's access permissions and determine if they   â”‚
â”‚   exhibit privilege creep. Consider their role, department, and   â”‚
â”‚   compare with peer users. Classify as HIGH_RISK_CREEP,          â”‚
â”‚   MODERATE_CREEP, LOW_RISK, or APPROPRIATE_ACCESS. Provide       â”‚
â”‚   specific recommendations."                                      â”‚
â”‚                                                                   â”‚
â”‚  Output (JSON):                                                   â”‚
â”‚  {                                                                â”‚
â”‚    "classification": "HIGH_RISK_CREEP",                          â”‚
â”‚    "confidence_score": 0.92,                                     â”‚
â”‚    "risk_factors": ["Excessive app access", "Stale group"],     â”‚
â”‚    "recommendations": ["Remove access to legacy apps", ...]      â”‚
â”‚  }                                                                â”‚
â”‚                                                                   â”‚
â”‚  Cost: ~$0.00025 per request (Haiku pricing)                     â”‚
â”‚  Performance: ~500ms average response time                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Use Case 2: Dormant User Detection                             â”‚
â”‚                                                                   â”‚
â”‚  Input:                                                           â”‚
â”‚  â€¢ User last login date                                           â”‚
â”‚  â€¢ Application access history (last 90 days)                      â”‚
â”‚  â€¢ Historical activity patterns                                   â”‚
â”‚                                                                   â”‚
â”‚  Model: Claude 3 Haiku                                           â”‚
â”‚                                                                   â”‚
â”‚  Output:                                                          â”‚
â”‚  â€¢ Dormancy classification (Dormant, At-Risk, Active)            â”‚
â”‚  â€¢ Stale applications (apps not accessed in X days)              â”‚
â”‚  â€¢ Recommended actions (disable access, notify manager)          â”‚
â”‚                                                                   â”‚
â”‚  Cost: ~$0.00020 per request                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Use Case 3: Embeddings for Semantic Search                     â”‚
â”‚                                                                   â”‚
â”‚  Input:                                                           â”‚
â”‚  â€¢ User profiles (name, email, role, department)                 â”‚
â”‚  â€¢ Application descriptions                                       â”‚
â”‚  â€¢ Group descriptions                                             â”‚
â”‚                                                                   â”‚
â”‚  Model: Titan Embeddings V2 (amazon.titan-embed-text-v2:0)      â”‚
â”‚                                                                   â”‚
â”‚  Output:                                                          â”‚
â”‚  â€¢ 1024-dimensional vector embeddings                             â”‚
â”‚  â€¢ Stored in PostgreSQL pgvector extension                        â”‚
â”‚  â€¢ Enables semantic similarity search                             â”‚
â”‚                                                                   â”‚
â”‚  Example Query:                                                   â”‚
â”‚  SELECT * FROM tenant_123.embeddings                             â”‚
â”‚  ORDER BY embedding <=> query_embedding                          â”‚
â”‚  LIMIT 10;                                                        â”‚
â”‚                                                                   â”‚
â”‚  Cost: ~$0.00010 per 1000 tokens                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model Selection Strategy                                        â”‚
â”‚                                                                   â”‚
â”‚  Development/Testing:                                             â”‚
â”‚  â€¢ Claude 3 Haiku - Fast, cost-effective                         â”‚
â”‚  â€¢ Cost: $0.00025 per request                                    â”‚
â”‚  â€¢ Speed: ~500ms                                                  â”‚
â”‚                                                                   â”‚
â”‚  Production (future):                                             â”‚
â”‚  â€¢ Claude 3 Sonnet - Higher accuracy for critical decisions      â”‚
â”‚  â€¢ Cost: $0.003 per request                                      â”‚
â”‚  â€¢ Speed: ~1000ms                                                 â”‚
â”‚  â€¢ Use for: High-risk privilege creep detection                  â”‚
â”‚                                                                   â”‚
â”‚  Embeddings (all environments):                                   â”‚
â”‚  â€¢ Titan Embeddings V2 - Optimized for semantic search           â”‚
â”‚  â€¢ Cost: $0.00010 per 1000 tokens                                â”‚
â”‚  â€¢ Speed: ~200ms                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AI Agent Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AI Agent Pattern                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Agent: Privilege Creep Agent
Location: assurex-insights-engine/functions/privilege-creep-agent/

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lambda Function: assurex-privilege-creep-agent-{stage}          â”‚
â”‚                                                                   â”‚
â”‚  Trigger:                                                         â”‚
â”‚  â€¢ Event Router (async invocation)                               â”‚
â”‚  â€¢ Manual API call (testing)                                     â”‚
â”‚  â€¢ EventBridge schedule (future)                                 â”‚
â”‚                                                                   â”‚
â”‚  Processing Flow:                                                 â”‚
â”‚  1. Receive tenant_id                                            â”‚
â”‚  2. Query PostgreSQL for users, groups, apps                     â”‚
â”‚  3. Batch users (default: 50 per batch)                          â”‚
â”‚  4. For each user:                                               â”‚
â”‚     a. Fetch profile and access data                             â”‚
â”‚     b. Query peer users for comparison                           â”‚
â”‚     c. Build prompt with context                                 â”‚
â”‚     d. Call Bedrock Claude Haiku                                 â”‚
â”‚     e. Parse JSON response                                       â”‚
â”‚     f. Store insight in privilege_creep_insights table           â”‚
â”‚  5. Generate summary statistics                                  â”‚
â”‚  6. Return results                                               â”‚
â”‚                                                                   â”‚
â”‚  Output:                                                          â”‚
â”‚  {                                                                â”‚
â”‚    "users_analyzed": 31,                                         â”‚
â”‚    "insights_generated": 31,                                     â”‚
â”‚    "classifications": {                                           â”‚
â”‚      "HIGH_RISK_CREEP": 5,                                       â”‚
â”‚      "MODERATE_CREEP": 9,                                        â”‚
â”‚      "LOW_RISK": 0,                                              â”‚
â”‚      "APPROPRIATE_ACCESS": 17                                    â”‚
â”‚    },                                                             â”‚
â”‚    "total_cost_usd": 0.008                                       â”‚
â”‚  }                                                                â”‚
â”‚                                                                   â”‚
â”‚  Performance:                                                     â”‚
â”‚  â€¢ 31 users analyzed in ~15 seconds                              â”‚
â”‚  â€¢ Parallel Bedrock calls (asyncio)                              â”‚
â”‚  â€¢ Cost: $0.008 for 31 users (~$0.00025/user)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Architecture

### Environments

| Environment | Region | VPC CIDR | Frontend URL | API URL | Status |
|-------------|--------|----------|--------------|---------|--------|
| **Development** | us-east-1 | 10.0.0.0/16 | localhost:3000 | api-dev.trustx.cloud | âœ… Active |
| **Preprod** | us-east-2 | 10.1.0.0/16 | app-stg.trustx.cloud | api-stg.trustx.cloud | âœ… Active |
| **Production** | us-east-1 | 10.2.0.0/16 | app.trustx.cloud | api.trustx.cloud | âŒ Pending |

### Deployment Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Deployment Pipeline                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Repository: trustx (Frontend)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Developer â†’ Git Push â†’ GitHub â†’ Vercel
                                  â”‚
                                  â”œâ”€â†’ Preview (PR branches)
                                  â”œâ”€â†’ Staging (dev branch)
                                  â””â”€â†’ Production (main branch)

Repository: assurex-infra (Infrastructure)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Developer â†’ Git Commit â†’ Manual Deploy
                         â”‚
                         â””â”€â†’ serverless deploy --stage {stage}
                               â€¢ Lambda functions
                               â€¢ AppSync API
                               â€¢ CloudFormation stacks

Repository: profile-360-backend (Profile360 API)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Developer â†’ Git Push â†’ GitHub Actions
                         â”‚
                         â”œâ”€â†’ PR: Deploy to dev
                         â””â”€â†’ Merge: Deploy to preprod

Repository: assurex-insights-engine (ETL & AI)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Developer â†’ Git Commit â†’ Manual Deploy
                         â”‚
                         â””â”€â†’ serverless deploy --stage {stage}
                               â€¢ Event router
                               â€¢ AI agents
                               â€¢ ETL processors
```

### Deployment Commands

```bash
# Frontend (trustx)
cd trustx/
git push origin main  # Auto-deploys to Vercel production

# Infrastructure (assurex-infra)
cd assurex-infra/
serverless deploy --stage dev --region us-east-1
serverless deploy --stage preprod --region us-east-2

# Profile360 API (profile-360-backend)
cd profile-360-backend/
serverless deploy --stage dev --region us-east-1
# OR
npm run deploy:dev

# Insights Engine (assurex-insights-engine)
cd assurex-insights-engine/functions/privilege-creep-agent/
serverless deploy --stage dev --region us-east-1

cd ../event-router/
serverless deploy --stage dev --region us-east-1
```

---

## Monitoring & Observability

### CloudWatch Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Monitoring & Logging                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Lambda Logs:
â€¢ /aws/lambda/assurex-privilege-creep-agent-dev
â€¢ /aws/lambda/assurex-profile360-event-router-dev
â€¢ /aws/lambda/assurex-profile360-neo4j-sync-dev
â€¢ /aws/lambda/profile-360-backend-dev-api

Metrics:
â€¢ Invocation count
â€¢ Error rate
â€¢ Duration (p50, p90, p99)
â€¢ Concurrent executions
â€¢ Throttles

Alarms (future):
â€¢ Lambda error rate > 5%
â€¢ API Gateway 5xx errors > 1%
â€¢ RDS CPU > 80%
â€¢ Lambda duration > 25s
```

### Performance Metrics

| Component | Metric | Target | Current |
|-----------|--------|--------|---------|
| **API Gateway** | Latency (p99) | < 1s | ~500ms |
| **Lambda Cold Start** | Duration | < 5s | ~3s |
| **Lambda Warm** | Duration | < 1s | ~300ms |
| **RDS Queries** | Response time | < 100ms | ~50ms |
| **Neo4j Queries** | Response time | < 200ms | ~150ms |
| **Bedrock Inference** | Response time | < 2s | ~500ms |

---

## Cost Analysis

### Monthly Cost Estimate (Development)

| Service | Usage | Cost |
|---------|-------|------|
| **RDS PostgreSQL** | db.t3.micro, 20GB gp3 | $35 |
| **NAT Gateway** | 1 NAT @ $0.045/hr | $32 |
| **Lambda** | 1M requests, 512MB, 5s avg | $8 |
| **API Gateway** | 1M requests | $3.50 |
| **Neo4j Aura** | Free tier per tenant | $0 |
| **Bedrock** | 10K requests/month Haiku | $2.50 |
| **S3** | 10GB storage, 100K requests | $0.50 |
| **Secrets Manager** | 5 secrets | $2 |
| **CloudWatch** | Logs, metrics | $5 |
| **VPC** | Flow logs | $2 |
| **Total** | | **~$90/month** |

### Production Scaling

At 1000 tenants, 1M users:
- RDS: Upgrade to db.r5.xlarge (~$500/month)
- Lambda: ~$200/month (more invocations)
- Bedrock: ~$100/month (more AI inference)
- Neo4j: ~$2000/month (paid tiers, multiple instances)
- Total: **~$3000/month**

---

## Future Enhancements

### Planned Architecture Changes

1. **S3 Event Notifications**
   - Auto-trigger event router on S3 uploads
   - Eliminate manual pipeline triggers

2. **GraphRAG Integration**
   - Phase 5: Natural language queries on knowledge graph
   - Bedrock + Neo4j semantic search

3. **Production Environment**
   - us-east-1 production deployment
   - Multi-region failover (future)

4. **Advanced Monitoring**
   - X-Ray tracing
   - CloudWatch alarms
   - Slack notifications

5. **Performance Optimization**
   - Lambda SnapStart
   - Connection pooling for RDS
   - Redis cache layer (future)

6. **Security Enhancements**
   - AWS WAF for API Gateway
   - GuardDuty for threat detection
   - VPC endpoints for AWS services

---

**Document Version**: 1.0.0
**Last Updated**: October 31, 2025
**Maintained By**: AssureX Engineering Team
**Next Review**: November 30, 2025
